class HomeController < ApplicationController

  def index
<<<<<<< HEAD
    #@markers = markers
=======
    @markers = markers()
>>>>>>> 94991e525f7c365b3a7fa0de1fcc8b870c2fd00e
    @needs = Need.includes(:organization).order('created_at desc').last(5)
    respond_to do |format|
      format.html { @markers = markers('html').to_json}
      format.json { render json: markers('json').to_json   }
    end
  end


  private

<<<<<<< HEAD
  def markers(format)
    markers = []
    Organization.all.each do |org|
      @needs = org.needs
      markers << { :lat => org.latitude, :lng => org.longitude,
                   :picture => org.marker_path, :width => 48, :height => 48 }
      markers.last[:description] = render_to_string("popup_content", :layout => false) if format.eql? "html"
    end
    markers
=======
  def markers
    Organization.all.to_gmaps4rails do |org, marker|
      marker.infowindow render_to_string(:partial => "organizations/organization", :locals => { :organization => org})
      marker.picture({
                      :picture => org.marker_path,
                      :width   => 48,
                      :height  => 48
                     })
    end
>>>>>>> 94991e525f7c365b3a7fa0de1fcc8b870c2fd00e
  end

end
